<!DOCTYPE html>
<html id="J-html" class="">
<head>
    <meta charset="UTF-8" />
    <title>
        
            Jsp处理复杂对象
        
    </title>
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="phy" />
    <meta name="description" content="在页面中，许多功能往往需要多个基础类的查询。可以构建一个基于页面的复杂类，来处理页面的功能需求。这里以一个User对应多个Role对象为例，创建UserRoleList视图类。" />
    <meta name="keywords" content="java,jsp,spring" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" type="text/css" media="all" href="../../../static/style.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../../../static/pygments.css" />

    <!--[if lt IE 9]>
    <script src="http://pp1230.github.io/static/js/html5.js" type="text/javascript"></script>
    <![endif]-->
    <script src="http://pp1230.github.io/static/js/jquery.js" type="text/javascript"></script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>
<body itemscope itemtype="http://schema.org/WebPage" class="home blog lotus index">
    <nav class="lotus-nav">
        <ul>
            
            
            
            
            
                
            
            <li class="home ">
                <a href="/index.html" rel="bookmark" title="首页">
                    <i class="icon-home"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/archives.html" rel="bookmark" title="文章归档">
                    <i class="icon-reorder"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/contact.html" rel="bookmark" title="关于我">
                    <i class="icon-envelope-alt"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/love/pwd.html" rel="bookmark" title="love shuwei">
                    <i class="icon-heart"></i>
                </a>
                
            </li>
            
            
            
            
            
            <li class="">
                <a href="/resource.html" rel="bookmark" title="资源">
                    <i class="icon-github"></i>
                </a>
                
            </li>
            
        </ul>
    </nav>

    <p class="lotus-breadcrub">
    <a href="http://pp1230.github.io/index.html" rel="nofollow" rel="nofollow" title="首页">Home</a>
    <span> &gt; </span>
    <a href="http://pp1230.github.io/archives.html" rel="nofollow" >Archives</a>
    <span> &gt; </span>
    Jsp处理复杂对象
</p>
<h1 class="lotus-pagetit">Jsp处理复杂对象</h1>
<p class="lotus-meta">Publish: <time class="date" pubdate="November 23, 2015">November 23, 2015</time></p>
<article  itemscope itemtype="http://schema.org/Article" class="lotus-post">
<h2 id="section">1.数据库表结构</h2>
<p>SecurityUser和SecurityRole是多对多的关系，其中SecurityUserRole使关联对象。对应到数据库中：</p>

<p><img src="../../../static/images/securityrole.png" alt="securityrole" />
<img src="../../../static/images/securityuser.png" alt="securityuser" />
<img src="../../../static/images/securityuserrole.png" alt="securityuserrole" /></p>

<h2 id="section-1">2.实体类和视图类</h2>

<p>User和Role的关联类，User类。（Role类省略）</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"security_user"</span><span class="o">)</span>
<span class="nd">@NamedQuery</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"SecurityUser.findAll"</span><span class="o">,</span> <span class="n">query</span><span class="o">=</span><span class="s">"SELECT s FROM SecurityUser s"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityUser</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">48</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">uid</span><span class="o">;</span>
	
	<span class="nd">@Column</span><span class="o">(</span><span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
	<span class="nd">@SequenceGenerator</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"security_user_id_seq"</span><span class="o">,</span> <span class="n">allocationSize</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">initialValue</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"security_user_id_seq"</span><span class="o">)</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">SEQUENCE</span><span class="o">,</span> <span class="n">generator</span> <span class="o">=</span> <span class="s">"security_user_id_seq"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Timestamp</span> <span class="n">birthday</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"computer_id"</span><span class="o">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">computerId</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"create_time"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Timestamp</span> <span class="n">createTime</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"create_user_uid"</span><span class="o">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">48</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">createUserUid</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">18</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">idcard</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"last_login_ip"</span><span class="o">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">lastLoginIp</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"last_login_time"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Timestamp</span> <span class="n">lastLoginTime</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">maxim</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">mobile</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">10</span><span class="o">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">BigDecimal</span> <span class="n">money</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">nickname</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">64</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">phone</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">255</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">picture</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">rank</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">realname</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">region</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">salt</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">score</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">2</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">sex</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">status</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">30</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>

	<span class="c1">//bi-directional many-to-one association to Group</span>
	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"securityUser"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Group</span><span class="o">&gt;</span> <span class="n">groups</span><span class="o">;</span>

    <span class="c1">//在此处进行映射可以方便查找出此SecurityUser对应的SecurityUserRole</span>
    <span class="c1">//然后利用List&lt;SecurityUserRole&gt;可以查找出SecurityRole</span>
	<span class="c1">//bi-directional many-to-one association to SecurityUserRole</span>
	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"securityUser"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SecurityUserRole</span><span class="o">&gt;</span> <span class="n">securityUserRoles</span><span class="o">;</span>
	<span class="c1">//省略setter、getter</span>
	<span class="o">.........</span>
<span class="o">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"security_user_role"</span><span class="o">)</span>
<span class="nd">@NamedQuery</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"SecurityUserRole.findAll"</span><span class="o">,</span> <span class="n">query</span><span class="o">=</span><span class="s">"SELECT s FROM SecurityUserRole s"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityUserRole</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

	<span class="nd">@Id</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
	<span class="nd">@SequenceGenerator</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"security_user_role_id_seq"</span><span class="o">,</span> <span class="n">allocationSize</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">initialValue</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">sequenceName</span> <span class="o">=</span> <span class="s">"security_use_role_id_seq"</span><span class="o">)</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">SEQUENCE</span><span class="o">,</span> <span class="n">generator</span> <span class="o">=</span> <span class="s">"security_user_role_id_seq"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">48</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">departemntvalue</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">length</span><span class="o">=</span><span class="mi">48</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">String</span> <span class="n">departmentid</span><span class="o">;</span>

	<span class="kd">private</span> <span class="n">Integer</span> <span class="n">priority</span><span class="o">;</span>

	<span class="c1">//bi-directional many-to-one association to SecurityRole</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"role_id"</span><span class="o">,</span><span class="n">referencedColumnName</span><span class="o">=</span><span class="s">"id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">SecurityRole</span> <span class="n">securityRole</span><span class="o">;</span>

	<span class="c1">//bi-directional many-to-one association to SecurityUser</span>
	<span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"user_uid"</span><span class="o">,</span><span class="n">referencedColumnName</span><span class="o">=</span><span class="s">"uid"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">SecurityUser</span> <span class="n">securityUser</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">SecurityUserRole</span><span class="o">()</span> <span class="o">{</span>
	<span class="o">}</span>
	<span class="c1">//省略setter、getter</span>
	<span class="o">.........</span>
	<span class="o">}</span></code></pre></div>

<p>视图类：</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserRoleList</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="n">SecurityUser</span> <span class="n">user</span><span class="o">;</span>
	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">SecurityRole</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">;</span>
	<span class="c1">//省略setter、getter</span>
	<span class="o">.........</span>
	<span class="o">}</span></code></pre></div>

<h2 id="handler">3.Handler页面跳转类</h2>

<p>使用SpringMVC架构，此为Controller层。前台写的较为臃肿，最好可以将复杂逻辑放入Service层。</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityUserRoleHandler</span> <span class="o">{</span>

	<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="n">SecurityUserService</span> <span class="n">securityUserService</span><span class="o">;</span>
<span class="nd">@Autowired</span>
	<span class="kd">private</span> <span class="n">SecurityRoleService</span> <span class="n">securityRoleService</span><span class="o">;</span>
<span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">SecurityUserRoleService</span> <span class="n">securityUserRoleService</span><span class="o">;</span>
<span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="n">UserRoleListService</span> <span class="n">userRoleListService</span><span class="o">;</span>

<span class="c1">//保存用户信息</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/backui/userrole/save"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">input</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
		<span class="c1">//传递所有角色到页面</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"securityroles"</span><span class="o">,</span><span class="n">securityRoleService</span><span class="o">.</span><span class="na">getAll</span><span class="o">());</span>
		<span class="k">return</span> <span class="s">"backui/userrole/input"</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//接收用户信息</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/backui/userrole/save"</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">save</span><span class="o">(</span><span class="n">UserRoleList</span> <span class="n">userRoleList</span><span class="o">){</span>
		<span class="c1">//先保存user</span>
		<span class="n">securityUserService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getUser</span><span class="o">());</span>
		<span class="k">if</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">()!=</span><span class="kc">null</span><span class="o">)</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
			<span class="n">SecurityUserRole</span> <span class="n">securityUserRole</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecurityUserRole</span><span class="o">();</span>
			<span class="n">securityUserRole</span><span class="o">.</span><span class="na">setSecurityUser</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getUser</span><span class="o">());</span>
			<span class="n">securityUserRole</span><span class="o">.</span><span class="na">setSecurityRole</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
			<span class="c1">//再保存复杂对象中的roles</span>
			<span class="k">if</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">()!=</span><span class="kc">null</span><span class="o">){</span>
			<span class="n">SecurityRole</span> <span class="n">role</span><span class="o">=</span><span class="n">securityRoleService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
			<span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">setName</span><span class="o">(</span><span class="n">role</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
			<span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">setDescription</span><span class="o">(</span><span class="n">role</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
			<span class="n">securityRoleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
			<span class="c1">//最后保存本身</span>
		<span class="n">securityUserRoleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">securityUserRole</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="c1">//securityUserRoleService.save(securityUserRole);</span>
		<span class="k">return</span> <span class="s">"backui/users/list"</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//更新用户</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/backui/userrole/update/{useruid}"</span><span class="o">,</span> <span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">preUpdate</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"useruid"</span><span class="o">)</span> <span class="n">String</span> <span class="n">useruid</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
		<span class="n">SecurityUser</span> <span class="n">user</span> <span class="o">=</span> <span class="n">securityUserService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">useruid</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"securityuser"</span><span class="o">,</span> <span class="n">user</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">SecurityUserRole</span><span class="o">&gt;</span> <span class="n">userroles</span> <span class="o">=</span> <span class="n">securityUserRoleService</span><span class="o">.</span><span class="na">findBySecurityUser</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
		<span class="n">List</span><span class="o">&lt;</span><span class="n">SecurityRole</span><span class="o">&gt;</span> <span class="n">roles</span> <span class="o">=</span> <span class="n">securityRoleService</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
	    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">,</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">roles</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
			<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">userroles</span><span class="o">.</span><span class="na">size</span><span class="o">();</span><span class="n">j</span><span class="o">++){</span>
				<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">roles</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">()+</span><span class="s">"/"</span><span class="o">+</span><span class="n">userroles</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">).</span><span class="na">getSecurityRole</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
				<span class="k">if</span><span class="o">(</span><span class="n">roles</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">userroles</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">j</span><span class="o">).</span><span class="na">getSecurityRole</span><span class="o">().</span><span class="na">getId</span><span class="o">())){</span>
					<span class="n">roles</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
					<span class="n">k</span><span class="o">++;</span>
					<span class="n">j</span><span class="o">=</span><span class="n">userroles</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
			<span class="n">i</span><span class="o">-=</span><span class="n">k</span><span class="o">;</span>
			<span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
	    <span class="o">}</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"securityroles"</span><span class="o">,</span><span class="n">roles</span><span class="o">);</span>
		<span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"securityuserroles"</span><span class="o">,</span> <span class="n">userroles</span><span class="o">);</span>
		<span class="k">return</span> <span class="s">"backui/userrole/input"</span><span class="o">;</span>
	<span class="o">}</span>
	
	<span class="c1">//前台返回</span>
	<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/backui/userrole/update/{useruid}"</span><span class="o">,</span><span class="n">method</span><span class="o">={</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">,</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">})</span>
	<span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">UserRoleList</span> <span class="n">userRoleList</span><span class="o">){</span>
		<span class="c1">//先保存用户</span>
		<span class="n">securityUserService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getUser</span><span class="o">());</span>
		<span class="c1">//清除以前的用户角色</span>
		<span class="n">userRoleListService</span><span class="o">.</span><span class="na">deleteRoleByUser</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getUser</span><span class="o">());</span>
		<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">size</span><span class="o">();</span><span class="n">i</span><span class="o">++){</span>
			<span class="n">SecurityUserRole</span> <span class="n">securityUserRole</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecurityUserRole</span><span class="o">();</span>
			<span class="n">securityUserRole</span><span class="o">.</span><span class="na">setSecurityUser</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getUser</span><span class="o">());</span>
			<span class="n">securityUserRole</span><span class="o">.</span><span class="na">setSecurityRole</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
			<span class="k">if</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">()!=</span><span class="kc">null</span><span class="o">){</span>
			<span class="n">SecurityRole</span> <span class="n">role</span><span class="o">=</span><span class="n">securityRoleService</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
			<span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">setName</span><span class="o">(</span><span class="n">role</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
			<span class="n">userRoleList</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">setDescription</span><span class="o">(</span><span class="n">role</span><span class="o">.</span><span class="na">getDescription</span><span class="o">());</span>
			<span class="n">securityRoleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
		<span class="n">securityUserRoleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">securityUserRole</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">}</span>
		<span class="k">return</span> <span class="s">"backui/users/list"</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span></code></pre></div>

<h2 id="jsp">4.前台JSP页面处理复杂对象</h2>

<p>Jsp页面接收时，需要在Handler中的Map里放入需要的对象，而在回传时，复杂对象是由后台进行组装的，不需要Map中有此对象。例如：SecurityUserRoleHandler的save方法并没有传入UserRoleList，后台依然可以接收到此对象。</p>

<div class="highlight"><pre><code class="language-jsp" data-lang="jsp">&lt;%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%&gt;
&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%&gt;

&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
&lt;title&gt;添加用户&lt;/title&gt;
&lt;%-- &lt;script type="text/javascript"
	src="${pageContext.request.contextPath }/scripts/jquery-1.9.1.min.js"&gt;&lt;/script&gt; 
&lt;link href="${pageContext.request.contextPath }/styles/assets/css/bootstrap.min.css" rel="stylesheet" /&gt;
&lt;link rel="stylesheet" href="${pageContext.request.contextPath }/styles/assets/css/font-awesome.min.css" /&gt;  --%&gt;
&lt;/head&gt;

&lt;body&gt;

	&lt;c:set value="${pageContext.request.contextPath }/backui/userrole/save"
		var="url"&gt;&lt;/c:set&gt;
	&lt;c:if test="${securityuser.uid != null}"&gt;
		&lt;c:set
			value="${pageContext.request.contextPath }/backui/userrole/update/${securityuser.uid}"
			var="url"&gt;&lt;/c:set&gt;
	&lt;/c:if&gt;

	&lt;div class="page-header"&gt;
		&lt;h4&gt;
			用户管理 &lt;small&gt; &lt;i class="icon-double-angle-right"&gt;&lt;/i&gt; 添加用户
			&lt;/small&gt;
		&lt;/h4&gt;
	&lt;/div&gt;
	&lt;div class="row"&gt;
		&lt;div class="col-xs-12" align="center"&gt;
			&lt;form action="#" attr_href="${url }" method="POST"
				class="form-horizontal" id="_form"&gt;

				&lt;c:if test="${securityuser.uid != null }"&gt;
					&lt;%-- 	&lt;form:hidden path="id" /&gt; --%&gt;
					&lt;input type="hidden" name="user.uid"
						value="${securityuser.uid } " /&gt;
					&lt;input type="hidden" name="user.id"
						value="${securityuser.id } " /&gt;
					&lt;input type="hidden" name="user.createTime"
						value="${securityuser.createTime } " /&gt;
				&lt;/c:if&gt;

				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;用户名
						:&lt;/label&gt; &lt;input class="col-xs-3" name="user.username"
						value="${securityuser.username}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;登录密码:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.password"
						value="${securityuser.password}" type="password" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;真实姓名
						:&lt;/label&gt; &lt;input class="col-xs-3" name="user.realname"
						value="${securityuser.realname}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
								&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;性别
						:&lt;/label&gt; &lt;input class="col-xs-3" name="user.sex"
						value="${securityuser.sex}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;昵称:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.nickname"
						value="${securityuser.nickname}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;邮箱:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.email"
						value="${securityuser.email}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;移动电话:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.mobile"
						value="${securityuser.mobile}" type="text" /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;地址:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.address"
						value="${securityuser.address}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;
				&lt;div class="form-group"&gt;
					&lt;label class="col-xs-3 control-label no-padding-right"&gt;身份证号码:&lt;/label&gt;
					&lt;input class="col-xs-3" name="user.idcard"
						value="${securityuser.idcard}" type="text" /&gt;&lt;br /&gt;
				&lt;/div&gt;

				&lt;label class="col-xs-3 control-label no-padding-right"&gt;选择角色：&lt;/label&gt;
				&lt;div class="col-xs-9" style="text-align:left"&gt;
				&lt;c:forEach var="list1" items="${securityroles}"  varStatus="vs1"&gt;
					&lt;label&gt;&lt;input name="roles[${vs1.index}].id" type="checkbox"
						value="&lt;c:out value="${list1.id}"/&gt;" /&gt; &lt;c:out
							value="${list1.name}" /&gt;&lt;/label&gt;
							&lt;c:if test="${vs1.index%5==0&amp;&amp;vs1.index!=0}"&gt;&lt;br/&gt;&lt;/c:if&gt;
				&lt;/c:forEach&gt;


				&lt;c:forEach var="list2" items="${securityuserroles}"varStatus="vs2"&gt;
					&lt;label&gt;&lt;input name="roles[${vs2.index+list1.size}].id" type="checkbox"
						checked="checked" value="&lt;c:out value="${list2.securityRole.id}"/&gt;" /&gt; &lt;c:out
							value="${list2.securityRole.name}" /&gt;&lt;/label&gt;
				&lt;/c:forEach&gt;
&lt;/div&gt;
				&lt;%-- 		 &lt;select class="combox" name="securityRole.id" class="col-xs-3"&gt;
						&lt;c:forEach var="list" items="${securityroles}"&gt;
							&lt;c:choose&gt;
								&lt;c:when test="${securityuserrole.securityRole.id==list.id}"&gt;
									&lt;option selected="selected"
										value="&lt;c:out value="${list.id}"/&gt;"&gt;
										&lt;c:out value="${list.name}" /&gt;
									&lt;/option&gt;
								&lt;/c:when&gt;
								&lt;c:otherwise&gt;
									&lt;option value="&lt;c:out value="${list.id}"/&gt;"&gt;
										&lt;c:out value="${list.name}" /&gt;
									&lt;/option&gt;
								&lt;/c:otherwise&gt;
							&lt;/c:choose&gt;
						&lt;/c:forEach&gt;
					&lt;/select&gt; --%&gt;
				&lt;%-- 		&lt;div class="form-group"&gt;
		&lt;label class="col-xs-3 control-label no-padding-right"&gt;性别:&lt;/label&gt; 
		&lt;input class="col-xs-3" name="sex" value="${securityuser.sex}"type="text"/&gt;&lt;br/&gt;
		&lt;/div&gt; --%&gt;
				&lt;%-- 		&lt;div class="form-group"&gt;
		&lt;label class="col-xs-3 control-label no-padding-right"&gt;生日:&lt;/label&gt; 
		&lt;input class="col-xs-3" name="birthday" value="${securityuser.birthday}"type="text"/&gt;&lt;br/&gt;
		&lt;/div&gt; --%&gt;
				&lt;!-- 		&lt;input type="submit" value="提交" /&gt; --&gt;
			&lt;/form&gt;
			&lt;div class="form-group"&gt;
				&lt;label class="col-xs-3 control-label no-padding-right"&gt;&lt;/label&gt;
				&lt;button type="submit" class="btn btn-info col-sm-1 no-padding-right"
					value="确定添加" href="#"
					onclick="submitFormByDivAndUrl(_form,'ebag_list','${pageContext.request.contextPath }/backui/users/list')"&gt;
					&lt;i class="icon-undo bigger-110"&gt;&lt;/i&gt;提交
				&lt;/button&gt;
				&lt;button type="submit" class="btn col-sm-1 no-padding-right"
					value="确定添加" href="#"
					onclick="newJsp('${pageContext.request.contextPath }/backui/users/list','ebag_list')"&gt;
					&lt;i class="icon-undo bigger-110"&gt;&lt;/i&gt;返回
				&lt;/button&gt;
			&lt;/div&gt;
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

<p>以下是添加用户并选择角色的页面，其实是把一个SecurityUser和多个SecurityRole组装成一个复杂类UserRoleList回传给后台处理。</p>

<p><img src="../../../static/images/userrolelist.png" alt="junit" /></p>

<p>用到的技术：
JSP+SpringMVC+SpringDate+JPA</p>

</article>
<p class="lotus-anno">声明: 本文采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/" rel="nofollow" target="_blank" title="自由转载-非商用-非衍生-保持署名">BY-NC-SA</a> 授权。转载请注明转自: <a href="" title="" rel="nofollow">phy</a></p>
<section class="lotus-nextpage fn-clear">
    
    <div class="lotus-nextpage-left"><a class="prev" href="/2015/11/15/%E5%87%A0%E7%A7%8D%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%9A%84%E6%AF%94%E8%BE%83.html" rel="prev">&laquo;&nbsp;比较几种基本排序（一）</a></div>
    
    
    <div class="lotus-nextpage-right"><a class="next" href="/2015/12/13/%E8%AF%8D%E5%90%91%E9%87%8F%E5%92%8C%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B.html" rel="next">词向量和语言模型&nbsp;&raquo;</a></div>
    
</section>

<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/2015/11/23/Jsp处理复杂对象" data-title="Jsp处理复杂对象" data-url="/2015/11/23/Jsp%E5%A4%84%E7%90%86%E5%A4%8D%E6%9D%82%E5%AF%B9%E8%B1%A1.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"pp1230"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->




<footer class="lotus-footer">
	<p>Copyright © 2010–2015 PHY的博客 All rights reserved. On github <a href="https://github.com/pp1230" target="_blank">pp1230</a>.</p>
</footer>
<script src="http://pp1230.github.io/static/js/jquery.scrollTo.js" type="text/javascript"></script>
<script src="http://pp1230.github.io/static/js/iLotus.js" type="text/javascript"></script>
</body>
</html>
